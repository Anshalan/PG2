<html>

<head>
    <title>PG2_lab1_2_no_points</title>
    <meta name="author" content="Paweł Jędrzejczyk">
    <!-- <style>
        canvas {
            margin: auto;
            display: block;
        }
    </style> -->
</head>

<body>
<canvas id="myCanvas" width="800" height="600">
    Your browser does not support the canvas tag.
</canvas>
<script>
    let canvas = document.getElementById("myCanvas");
    let ctx = canvas.getContext("2d");
    //
    // class Car {
    //     width;
    //     height;
    //     X;
    //     Y;
    //     constructor() {
    //         this.width = 40;
    //         this.height = 80;
    //         this.X = canvas.width/2 - 10
    //         this.Y = canvas.height - 100
    //         // this.wheels = new Array();
    //         this.drawCar()
    //
    //     }
    //     drawCar() {
    //         ctx.fillStyle = 'pink';
    //         ctx.fillRect(this.X, this.Y, this.width, this.height);
    //         this.drawWheels()
    //         // this.rotateCar()
    //     }
    //     drawWheels(){
    //         ctx.fillStyle = 'black';
    //         ctx.fillRect(this.X-3, this.Y+5, 8, 15);
    //         ctx.fillRect(this.X-3, this.Y+this.height-15-5, 8, 15);
    //         ctx.fillRect(this.X+this.width-5, this.Y+5, 8, 15);
    //         ctx.fillRect(this.X+this.width-5, this.Y+this.height-15-5, 8, 15);
    //
    //     }
    //     rotateCar(direction){
    //         this.clearCar()
    //         ctx.translate((this.X+this.width/2), (this.Y+this.height/2))
    //         if (direction === 'left')
    //         {ctx.rotate(-0.1);}
    //         else if (direction === 'right')
    //        { ctx.rotate(0.1)};
    //         ctx.translate(-(this.X+this.width/2), -(this.Y+this.height/2))
    //
    //         this.drawCar()
    //     }
    //     clearCar()
    //     {
    //         ctx.fillStyle = 'white';
    //         ctx.fillRect(this.X-3, this.Y+5, 8, 15);
    //         ctx.fillRect(this.X-3, this.Y+this.height-15-5, 8, 15);
    //         ctx.fillRect(this.X+this.width-5, this.Y+5, 8, 15);
    //         ctx.fillRect(this.X+this.width-5, this.Y+this.height-15-5, 8, 15);
    //         ctx.fillRect(this.X, this.Y, this.width, this.height);
    //     }
    // }

    class RoadSegment {
        x;
        y;
        leftCurb;
        rightCurb;
        curbColor;
        width;
        height;

        constructor(X, Y, curbColor) {
            this.x = X;
            this.y = Y;
            this.width = 300;
            this.height = 60; // change do less
            this.curbColor = curbColor;
            this.draw()
        }

        draw() {
            ctx.fillStyle = 'grey';
            ctx.fillRect(this.x, this.y, this.width, this.height)
            this.leftCurb = new Curb(this.x - 20, this.y, this.curbColor);
            this.rightCurb = new Curb(this.x + this.width, this.y, this.curbColor);
            if (this.curbColor === 'white') {
                ctx.fillStyle = this.curbColor;
                ctx.fillRect(this.x + 145, this.y, 10, this.height)
            }
        }

        move() {
            this.y = this.y + 6;
            this.draw();
            // this.rightCurb.move();
            // this.leftCurb.move();
        }

        getColor() {
            return this.curbColor;
        }

        getX() {
            return this.x;
        }
    }

    class Curb {
        x;
        y;
        width;
        height;
        color;

        constructor(x, y, color) {
            this.x = x;
            this.y = y;
            this.color = color;
            this.width = 20;
            this.height = 60;
            this.draw()
        }

        draw() {
            ctx.fillStyle = this.color;
            ctx.fillRect(this.x, this.y, this.width, this.height)
        }

    }

    class Background {
        color;

        constructor(color) {
            this.color = color;
            this.draw()
        }

        draw() {
            ctx.fillStyle = this.color;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

        }
    }

    class Car{
        width;
        height;
        wheels;
        x;
        y;

        constructor() {
            this.height = 60;
            this.width=40;
            this.x = 380;
            this.y = 530;
            this.draw();

        }
        draw(){
            ctx.fillStyle = "cyan";
            ctx.fillRect(this.x,this.y,this.width, this.height);
        }
        // checkCollision(curbX,curbY){
        //     if
        //
        // }

    }
    class Race {
        roadArray;
        car;
        background;
        moveCounter;
        turnCounter;
        turn;

        constructor() {
            this.car = new Car();
            this.moveCounter = 0;
            this.turnCounter = 0;
            this.turn = 0;
            this.background = new Background("green");
            this.roadArray = [
                new RoadSegment(250, 540, "white"),
                new RoadSegment(250, 480, "red"),
                new RoadSegment(250, 420, "white"),
                new RoadSegment(250, 360, "red"),
                new RoadSegment(250, 300, "white"),
                new RoadSegment(250, 240, "red"),
                new RoadSegment(250, 180, "white"),
                new RoadSegment(250, 120, "red"),
                new RoadSegment(250, 60, "white"),
                new RoadSegment(250, 0, "red"),
                new RoadSegment(250, -60, "white")
            ];

        }

        moveRoad() {
            this.moveCounter++;
            this.turnCounter++;
            if (this.turnCounter === 100) {
                this.turnCounter = 0
                this.turn = this.randRoadDirection();
            }
            this.background.draw();
            this.roadArray.forEach(this.moveRoadElement);
            this.car.draw();
            if (this.moveCounter === 10) {
                this.moveCounter = 0;
                this.roadArray.shift();
                var newX = this.roadArray[9].getX() + this.turn;
                if (newX < 20) {
                    newX = 20;
                }else if (newX > 440){
                    newX = 440;
            }
            this.roadArray.push(new RoadSegment(newX, -60, this.roadArray[0].getColor()))
        }
    }

    randRoadDirection()
    {
        let coin = Math.floor((Math.random() * 10) + 1);
        if (coin < 4) {
            return -5;
        } else if (coin < 7) {
            return 5;
        } else {
            return 0;
        }
    }

    moveRoadElement(item)
    {
        item.move();
    }

    }

    game = new Race();

    function aaa() {
        game.moveRoad();
    }

    window.setInterval(aaa, 800)

    // game.moveRoad();


    // class Road{
    //     leftCurb;
    //     rightCurb;
    //     constructor() {
    //         this.drawRoad();
    //     }
    //     drawRoad(){
    //         ctx.beginPath();
    //         ctx.moveTo(canvas.width/9*3 ,canvas.height);
    //         ctx.lineTo(canvas.width/9*3, 0);
    //         ctx.lineTo(canvas.width/9*6,0);
    //         ctx.lineTo(canvas.width/9*6,canvas.height);
    //         ctx.closePath();
    //         ctx.fillStyle = 'grey';
    //         ctx.fill();
    //         car.drawCar()
    //     }
    // }
    // class RoadLeft{
    //     constructor() {
    //         this.drawRoad();
    //     }
    //     drawRoad(){
    //         ctx.beginPath();
    //         // ctx.moveTo(canvas.width/9*3 ,canvas.height);
    //         ctx.arc(-1000, canvas.height,canvas.width/3 + 1000,0, 90);
    //         ctx.lineTo(-1000,canvas.width/3 + 1000,canvas.height);
    //         ctx.arc(-1000, canvas.height,canvas.width/3 + 1000 + canvas.width/3,0, 90, true);
    //
    //         ctx.closePath();
    //         ctx.fillStyle = 'grey';
    //         ctx.fill();
    //         car.drawCar()
    //     }
    // }
    // class RoadRight{
    //     constructor() {
    //         this.drawRoad();
    //     }
    //     drawRoad(){
    //         ctx.beginPath();
    //         // ctx.moveTo(canvas.width/9*3 ,canvas.height);
    //         ctx.arc(1000+ canvas.width, canvas.height,canvas.width/3 + 1000,180, 90, true);
    //         ctx.lineTo(1000+ canvas.width,canvas.width/3 + 1000,canvas.height);
    //         ctx.arc(1000+ canvas.width, canvas.height,canvas.width/3*2 + 1000,90, 180);
    //
    //         ctx.closePath();
    //         ctx.fillStyle = 'grey';
    //         ctx.fill();
    //
    //         ctx.beginPath();
    //         ctx.lineWidth = 10
    //         ctx.strokeStyle = 'white'
    //         ctx.setLineDash([50, 50]);
    //         ctx.beginPath();
    //         ctx.arc(1000+ canvas.width, canvas.height,canvas.width/2 + 1000,180, 90, true);
    //         // ctx.arc(1000+ canvas.width, canvas.height,canvas.width/2 + 1000,185, 91, true);
    //         ctx.closePath();
    //         ctx.stroke();
    //         ctx.rotate(0)
    //
    //         car.drawCar()
    //     }
    // }

    // function handleKeyPress(e) {
    //     if (e.keyCode === 37) {
    //         car.rotateCar("left")
    //     } else if (e.keyCode === 39) {
    //         car.rotateCar("right")
    //     }
    // }

    // document.onkeydown = (event) => { handleKeyPress(event, true) };
    // document.onkeyup = (event) => {handleKeyPress(event, false) };
    // window.addEventListener('keydown', handleKeyPress, true)
    // let car = new Car;
    // car.rotateCar('left');


    // let road = new Road();
    // let right = new RoadRight()
    // let left = new RoadLeft()


</script>

</body>

</html>
