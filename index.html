<html>
<head>
    <title>PG2_lab1_2</title>
</head>

<body>
<canvas id="myCanvas" width="800" height="600">
    Your browser does not support the canvas tag.
</canvas>


<script>

    var canvas = document.getElementById("myCanvas");
    var ctx1 = canvas.getContext("2d");
    var rectPositionX = canvas.width / 2 - 20;
    var rectPositionY = canvas.height - 20;
    var bulletY = -10;
    var bulletX = -10;
    var bulletHandle
    // var objects = new Array();

    init();

    function fire() {
        clearInterval(bulletHandle);
        clearBullet()
        bulletY = rectPositionY - 20
        bulletX = rectPositionX + 40 / 2
        ctx1.beginPath();
        ctx1.arc(bulletX, bulletY, 10, 0, 360);
        ctx1.closePath();

        ctx1.fillStyle = 'red';
        ctx1.fill();

        bulletHandle = setInterval(moveBullet,10)
        function moveBullet(){
            clearBullet();
            bulletY -= 10

            if(bulletY <10){
                clearBullet()
                clearInterval(bulletHandle);
            }
            ctx1.beginPath();
            ctx1.arc(bulletX, bulletY, 10, 0, 360);
            ctx1.closePath();
            ctx1.fillStyle = 'red';
            ctx1.fill();
        }
        function clearBullet(){
            ctx1.beginPath();
            ctx1.arc(bulletX, bulletY, 11, 0, 360);
            ctx1.closePath();
            ctx1.fillStyle = 'white';
            ctx1.fill();
        }
        // function killBullet(){
        //     clearInterval(bulletHandle)
        // }
    }



    function move(s) {
        ctx1.clearRect(rectPositionX - 1, rectPositionY - 1, 40 + 2, 20 + 2);
        if (s === "left") {
            if (rectPositionX > 0) {
                rectPositionX -= 10
            }
        } else if (s === "right") {
            if (rectPositionX < (canvas.width - 40)) {
                rectPositionX += 10
            }
        }

        ctx1.beginPath()
        ctx1.rect(rectPositionX, rectPositionY, 40, 20)
        ctx1.stroke()
        ctx1.closePath()
        ctx1.fillStyle = 'green';
        ctx1.fill();
    }

    function init() {
        window.addEventListener('keydown', handleKeyPress, true);
        ctx1.beginPath()
        ctx1.rect(rectPositionX, rectPositionY, 40, 20)
        ctx1.stroke()
        ctx1.closePath()
        ctx1.fillStyle = "green";
        ctx1.fill();
    }

    function handleKeyPress(e) {
        if (e.keyCode === 37) {
            move("left")
        } else if (e.keyCode === 39) {
            move("right")
        } else if (e.keyCode === 32) {
            fire()
        }
    }

    // function redraw()


</script>

</body>

</html>
